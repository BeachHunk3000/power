"use strict";angular.module("powerApp",["ngCookies","ngResource","ngSanitize","ngRoute","angularfire.firebase","angularfire.login","firebase","powerApp_base64","powerApp_auth"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{authRequired:!0,templateUrl:"partials/main",controller:"MainCtrl"}).when("/login",{authRequired:!1,templateUrl:"partials/login",controller:"LoginCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("powerApp").controller("MainCtrl",["$rootScope","$scope","$http","$firebase","Auth","simpleLogin","firebaseRef",function(a,b,c,d,e,f){b.method="GET",b.url="https://api.demosteinkjer.no/meters/0e6e348bfdb74432b6709526527c3d12/latest?seriesType=ActivePlus",e.setCredentials("3749f5da4f0d427faf9ed00bb616576e","7bf19829a91144028101feb1740bafb9"),b.fetch=function(){c({method:b.method,url:b.url,headers:{"Content-type":"application/json"}}).success(function(a,b){console.log(a),console.log(b)}).error(function(a,b){console.log(a||"Request failed"),console.log(b)})},b.logout=function(){f.logout(function(a){b.err=a?a+"":null})}}]),angular.module("powerApp").controller("LoginCtrl",["$scope","simpleLogin","$location",function(a,b,c){a.login=function(d){b.login(d,function(b){a.err=b?b+"":c.path("#/main")})}}]),angular.module("powerApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isActive=function(a){return a===b.path()}}]),angular.module("powerApp").constant("angularFireVersion","0.6").constant("loginRedirectPath","/login").constant("loginProviders","facebook").constant("FBURL","https://powerhack.firebaseio.com"),function(a){function b(a,b,c,d){this._route=c,this._location=a,this._rootScope=b,this._loginPath=d,this._redirectTo=null,this._authenticated=!(!b.auth||!b.auth.user),this._init()}a.module("powerApp").run(["$injector","$location","$rootScope","loginRedirectPath",function(a,c,d,e){a.has("$route")&&new b(c,d,a.get("$route"),e)}]),b.prototype={_init:function(){var b=this;this._checkCurrent(),b._rootScope.$on("$routeChangeStart",function(a,c){b._authRequiredRedirect(c,b._loginPath)}),b._rootScope.$on("$firebaseSimpleLogin:login",a.bind(this,this._login)),b._rootScope.$on("$firebaseSimpleLogin:logout",a.bind(this,this._logout)),b._rootScope.$on("$firebaseSimpleLogin:error",a.bind(this,this._logout))},_checkCurrent:function(){this._route.current&&this._authRequiredRedirect(this._route.current,this._loginPath)},_login:function(){this._authenticated=!0,this._redirectTo?(this._redirect(this._redirectTo),this._redirectTo=null):this._location.path()===this._loginPath&&(this._location.replace(),this._location.path("/"))},_logout:function(){this._authenticated=!1,this._checkCurrent()},_redirect:function(a){this._location.replace(),this._location.path(a)},_authRequiredRedirect:function(a,b){a.authRequired&&!this._authenticated?(this._redirectTo=void 0===a.pathTo?this._location.path():a.pathTo===b?"/":a.pathTo,this._redirect(b)):this._authenticated&&this._location.path()===this._loginPath&&this._redirect("/")}}}(angular),angular.module("angularfire.firebase",["firebase"]).factory("firebaseRef",["Firebase","FBURL",function(a,b){function c(a){for(var b=0;b<a.length;b++)"object"==typeof a[b]&&(a[b]=c(a[b]));return a.join("/")}return function(){return new a(c([b].concat(Array.prototype.slice.call(arguments))))}}]).service("syncData",["$firebase","firebaseRef",function(a,b){return function(c,d){var e=b(c);return d&&(e=e.limit(d)),a(e)}}]),angular.module("angularfire.login",["firebase","angularfire.firebase"]).run(["simpleLogin",function(a){a.init()}]).factory("simpleLogin",["$rootScope","$firebaseSimpleLogin","firebaseRef","$timeout","syncData",function(a,b,c,d){function e(){if(null===h)throw new Error("Must call loginService.init() before using its methods")}function f(a){var b=c("users");console.log(a),b.once("value",function(b){if(!b.hasChild(a.uid)){var d=c("users/"+a.uid+"/user_info/");d.set(a),g(a.uid)}})}function g(a){var b=c("/sensors/"),d=c("/users/"),e=null;b.once("value",function(b){b.forEach(function(b){console.log(b.val());var f=!0;if(d.once("value",function(a){a.forEach(function(a){a.val().sensor===e&&(f=!1)})}),f){var g=c("/users/"+a+"/sensor");return void g.set(b.val())}})})}var h=null;return{init:function(){return h=b(c()),a.auth=h,h},logout:function(){e(),h.$logout()},login:function(a,b){e(),h.$login(a,{rememberMe:!0,scope:"user_photos"}).then(function(a){f(a),b&&d(function(){b(null,a)})},b)}}}]),angular.module("powerApp").service("waitForAuth",["$rootScope","$q","$timeout",function(a,b,c){function d(b){a.auth&&(a.auth.error=b instanceof Error?b.toString():null);for(var d=0;d<f.length;d++)f[d]();c(function(){e.resolve()})}var e=b.defer(),f=[];return f.push(a.$on("$firebaseSimpleLogin:login",d)),f.push(a.$on("$firebaseSimpleLogin:logout",d)),f.push(a.$on("$firebaseSimpleLogin:error",d)),e.promise}]);